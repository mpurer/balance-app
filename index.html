<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Gyro Dot Target Game</title>
<style>
html, body { margin:0; padding:0; height:100%; width:100%; display:flex; justify-content:center; align-items:center; background:#f7f7f9; font-family:sans-serif; }
#arena { position:relative; width:100%; height:100%; background:#eee; overflow:hidden; }
#dot { position:absolute; width:36px; height:36px; border-radius:50%; background:#0575e6; transform:translate(-50%,-50%); }
#btn { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); padding:12px 18px; font-size:16px; z-index:10; }
#scoreDisplay, #timerDisplay { position:absolute; font-size:20px; font-weight:600; color:#111; background:rgba(255,255,255,0.7); padding:6px 12px; border-radius:8px; }
#scoreDisplay { top:12px; left:12px; }
#timerDisplay { top:12px; right:12px; }
#gameOver { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); font-size:48px; font-weight:700; color:#ff5c5c; display:none; }
canvas { position:absolute; left:0; top:0; }
</style>
</head>
<body>
<div id="arena">
  <canvas id="targetCanvas"></canvas>
  <div id="dot"></div>
  <div id="scoreDisplay">Score: 0</div>
  <div id="timerDisplay">30</div>
  <div id="gameOver"></div>
  <button id="btn">Enable Gyro</button>
</div>

<script>
const dot = document.getElementById('dot');
const btn = document.getElementById('btn');
const arena = document.getElementById('arena');
const scoreDisplay = document.getElementById('scoreDisplay');
const timerDisplay = document.getElementById('timerDisplay');
const gameOverEl = document.getElementById('gameOver');
const canvas = document.getElementById('targetCanvas');
const ctx = canvas.getContext('2d');

let arenaRect = arena.getBoundingClientRect();
canvas.width = arenaRect.width;
canvas.height = arenaRect.height;

let dotPos = { x: arenaRect.width/2, y: arenaRect.height/2 };

// ----- Target -----
const targetCenter = { x: arenaRect.width/2, y: arenaRect.height/2 };
const ringRadii = [30, 60, 90]; 
const maxDistance = ringRadii[ringRadii.length-1];
const maxPointsPerSecond = 10;

// ----- Scoring -----
let score = 0;
let lastTime = performance.now();
let timeLeft = 30; // seconds
let gameActive = true;

// ----- Update loop -----
function update() {
  const now = performance.now();
  const deltaTime = (now - lastTime)/1000;
  lastTime = now;

  if(gameActive){
    // Draw target
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = 'rgba(0,0,0,0.2)';
    ctx.lineWidth = 2;
    ringRadii.forEach(r => {
      ctx.beginPath();
      ctx.arc(targetCenter.x, targetCenter.y, r, 0, Math.PI*2);
      ctx.stroke();
    });
    ctx.fillStyle = '#ff5c5c';
    ctx.beginPath();
    ctx.arc(targetCenter.x, targetCenter.y, 6, 0, Math.PI*2);
    ctx.fill();

    // Scoring
    const dx = dotPos.x - targetCenter.x;
    const dy = dotPos.y - targetCenter.y;
    const distance = Math.hypot(dx, dy);
    if(distance <= maxDistance){
      score += maxPointsPerSecond * (1 - distance/maxDistance) * deltaTime;
    }
    scoreDisplay.textContent = 'Score: ' + Math.floor(score);

    // Timer
    timeLeft -= deltaTime;
    if(timeLeft <= 0){
      timeLeft = 0;
      endGame();
    }
    timerDisplay.textContent = Math.ceil(timeLeft);
  }

  requestAnimationFrame(update);
}
update();

// ----- Gyro control (landscape aware) -----
function handleOrientation(e){
  if(!gameActive) return;

  const gamma = e.gamma || 0; // left-right
  const beta = e.beta || 0;   // front-back
  const angle = screen.orientation?.angle || window.orientation || 0;

  let moveX = 0, moveY = 0;

  switch(angle){
    case 0:   moveX = gamma; moveY = beta; break; // portrait
    case 90:  moveX = -beta; moveY = gamma; break; // landscape right
    case -90: moveX = beta; moveY = -gamma; break; // landscape left
    case 180: moveX = -gamma; moveY = -beta; break; // upside down
    default: moveX = gamma; moveY = beta;
  }

  dotPos.x += moveX * 0.5;
  dotPos.y += moveY * 0.5;

  dotPos.x = Math.max(18, Math.min(arenaRect.width-18, dotPos.x));
  dotPos.y = Math.max(18, Math.min(arenaRect.height-18, dotPos.y));

  dot.style.left = dotPos.x + 'px';
  dot.style.top = dotPos.y + 'px';
}

// ----- Gyro enable -----
async function enableGyro(){
  if(typeof DeviceOrientationEvent !== 'undefined' &&
     typeof DeviceOrientationEvent.requestPermission === 'function'){
    try{
      const res = await DeviceOrientationEvent.requestPermission();
      if(res==='granted'){
        window.addEventListener('deviceorientation', handleOrientation);
        btn.style.display='none';
      } else alert('Permission denied');
    }catch(err){ alert('Error requesting permission'); }
  } else {
    window.addEventListener('deviceorientation', handleOrientation);
    btn.style.display='none';
  }
}

btn.addEventListener('click', enableGyro);

// ----- Game over -----
function endGame(){
  gameActive = false;
  gameOverEl.style.display = 'block';
  gameOverEl.textContent = 'Game Over\nScore: ' + Math.floor(score);
}

// ----- Resize -----
window.addEventListener('resize', ()=>{
  arenaRect = arena.getBoundingClientRect();
  canvas.width = arenaRect.width;
  canvas.height = arenaRect.height;
  targetCenter.x = arenaRect.width/2;
  targetCenter.y = arenaRect.height/2;
});
</script>
</body>
</html>
