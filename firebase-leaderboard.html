<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no, viewport-fit=cover" />
<title>Firebase Live Leaderboard</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script>
  // Your Firebase project configuration for "gibbon-balance-game"
  const firebaseConfig = {
    apiKey: "AIzaSyA7BZvLHuIXiYdukRpV7bM52pBBuWzv3rU", // <--- PASTE YOUR API KEY HERE
    authDomain: "gibbon-balance-game.firebaseapp.com",
    projectId: "gibbon-balance-game",
    storageBucket: "gibbon-balance-game.firebasestorage.app",
    messagingSenderId: "435375118778",
    appId: "1:435375118778:web:5513fc213d8d7fef816583" // <--- PASTE YOUR APP ID HERE
  };

  // Initialize Firebase and get Firestore instance
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<style>
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background: #05070f;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    color: #f5f5f5;
  }
  #header {
    width: 100%;
    padding: 18px 24px;
    background: #E8FC66;
    color: #111;
    font-size: 24px;
    font-weight: 800;
    box-shadow: 0 4px 18px rgba(0,0,0,0.28);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-sizing: border-box;
  }
  #headerLogo {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    height: 40px;
    width: auto;
    object-fit: contain;
  }
  #leaderboardModeSelection {
    margin-top: 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  .btnPrimary, .btnSecondary {
    padding: 10px 20px;
    border-radius: 999px;
    border: 0;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 15px;
  }
  .btnPrimary {
    background: #E8FC66;
    color: #111;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }
  .btnSecondary {
    background: #141824;
    color: #f5f5f5;
    box-shadow: 0 3px 12px rgba(0,0,0,0.35);
  }
  .btnPrimary:hover {
    background: #d4f349;
  }
  .btnSecondary:hover {
    background: #1b2030;
  }
  .leaderboardsRow {
    width: min(1200px, 96%);
    margin-top: 18px;
    display: flex;
    gap: 18px;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
  }
  .leaderboardCard {
    flex: 1 1 340px;
    max-width: 560px;
    border-radius: 16px;
    border: 1px solid rgba(232,252,102,0.25);
    background: radial-gradient(circle at top left,#141824,#05070f);
    box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .lbTitle {
    padding: 14px 18px;
    font-weight: 800;
    font-size: 18px;
    color: #E8FC66;
    border-bottom: 1px solid rgba(232,252,102,0.4);
    text-align: center;
  }
  .lbTableWrapper {
    max-height: 360px;
    overflow-y: auto;
  }
  table.leaderboardTable {
    width: 100%;
    border-collapse: collapse;
    font-size: 18px;
  }
  thead th {
    background: rgba(5,7,15,0.96);
    color: #E8FC66;
    padding: 15px 18px;
    font-weight: 700;
    text-align: center;
    border-bottom: 1px solid rgba(232,252,102,0.4);
  }
  tbody td {
    padding: 15px 18px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    color: #f5f5f5;
  }
  td.rank { width: 80px; text-align: center; font-weight: bold; }
  td.name { text-align: center; }
  td.score { text-align: right; width: 120px; font-weight: bold; }
  tbody tr:nth-child(even) { background: rgba(255,255,255,0.03); }
  tbody tr:last-child td { border-bottom: none; }
  .topRow {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    padding: 0 12px;
    box-sizing: border-box;
    flex-wrap: wrap;
  }
  .qrCallout {
    width: 220px;
    margin-top: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(232,252,102,0.3);
    background: #05070f;
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
  }
  .qrCallout img {
    width: 68px;
    height: 68px;
    border-radius: 10px;
    object-fit: cover;
    border: 1px solid #f0f0f0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .qrCopy {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .qrCopy .headline {
    font-size: 16px;
    font-weight: 800;
    color: #E8FC66;
  }
  @media (max-width: 760px) {
    .topRow {
      gap: 10px;
    }
    .qrCallout {
      width: min(360px, 92%);
      margin-top: 0;
    }
  }
</style>
</head>
<body>
  <div id="header">
    <img id="headerLogo" src="gibbon_logo.png" alt="Gibbon brand logo" />
    Gibbon Balance Game Live Leaderboard
  </div>

  <div class="topRow">
    <div class="qrCallout" aria-label="Scan the QR code to open the game">
      <img src="QR_balance_app.png" alt="QR code to open the game" />
      <div class="qrCopy">
        <div class="headline">Scan. Play. Win Prizes!</div>
      </div>
    </div>
  </div>

  <div class="leaderboardsRow">
    <div class="leaderboardCard" aria-label="Moving Target Leaderboard">
      <div class="lbTitle">Moving Target Leaderboard</div>
      <div class="lbTableWrapper">
        <table class="leaderboardTable">
          <thead>
            <tr><th>Rank</th><th class="name">Name</th><th class="score">Score</th></tr>
          </thead>
          <tbody id="leaderboardBodyMoving">
            <tr><td colspan="3" style="text-align:center;padding:20px;color:#cfd2d8">Loading leaderboard...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="leaderboardCard" aria-label="Survival Arena Leaderboard">
      <div class="lbTitle">Survival Arena Leaderboard</div>
      <div class="lbTableWrapper">
        <table class="leaderboardTable">
          <thead>
            <tr><th>Rank</th><th class="name">Name</th><th class="score">Score</th></tr>
          </thead>
          <tbody id="leaderboardBodySurvival">
            <tr><td colspan="3" style="text-align:center;padding:20px;color:#cfd2d8">Loading leaderboard...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<script>
  // Elements
  const leaderboardBodyMoving = document.getElementById('leaderboardBodyMoving');
  const leaderboardBodySurvival = document.getElementById('leaderboardBodySurvival');

  // State
  let unsubscribeMoving = null;
  let unsubscribeSurvival = null;

  // Helper for escaping HTML (for player names)
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

  function subscribeToLeaderboard(collectionRef, targetBody){
    const unsubscribe = collectionRef
      .orderBy('score', 'desc')
      .orderBy('timestamp', 'desc')
      .limit(500)
      .onSnapshot(snapshot => {
        targetBody.innerHTML = '';
        if (snapshot.empty) {
          targetBody.innerHTML = `<tr><td colspan="3" style="text-align:center;padding:20px;color:#cfd2d8">No scores yet for this level. Play the game to add some!</td></tr>`;
          return;
        }
        let rank = 1;
        snapshot.forEach((doc) => {
          const data = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `<td class="rank">${rank}</td><td class="name">${escapeHtml(data.playerName)}</td><td class="score">${data.score}</td>`;
          targetBody.appendChild(tr);
          rank++;
        });
      }, error => {
        console.error("Error fetching leaderboard: ", error);
        targetBody.innerHTML = `<tr><td colspan="3" style="text-align:center;padding:20px;color:#e60000">Error loading leaderboard.</td></tr>`;
      });
    return unsubscribe;
  }

  // Initial load: subscribe to both leaderboards
  document.addEventListener('DOMContentLoaded', () => {
    leaderboardBodyMoving.innerHTML = `<tr><td colspan="3" style="text-align:center;padding:20px;color:#cfd2d8">Loading leaderboard...</td></tr>`;
    leaderboardBodySurvival.innerHTML = `<tr><td colspan="3" style="text-align:center;padding:20px;color:#cfd2d8">Loading leaderboard...</td></tr>`;

    unsubscribeMoving = subscribeToLeaderboard(db.collection('leaderboardLevel2'), leaderboardBodyMoving);
    unsubscribeSurvival = subscribeToLeaderboard(db.collection('leaderboardSurvival'), leaderboardBodySurvival);
  });
</script>
</body>
</html>
